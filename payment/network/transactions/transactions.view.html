<div class="row white-bg border-bottom page-headings">
    <div class="page-heading heading-main">
        <div class="col-md-12">
            <div class="breadcrumb-wrapper">
                <i class="fa fa-money"></i>
                <ol class="breadcrumb m-l-sm">
                    <li class="active">Finance: Transactions<span ng-show="transactionCtrl.vm.userEvent.selectedUserName"> / {{transactionCtrl.vm.userEvent.selectedUserName}}</span></li>
                </ol>
            </div>
            <div class="pull-right heading-actions-wrapper">
                <div class="heading-actions">
                    <div class="heading-action">
                        <div class="btn-group">
                            <button type="button" class="btn btn-white dropdown-toggle" data-toggle="dropdown">
                                <i class="fa fa-upload"></i>
                                <span>Export</span>
                                <span class="caret"></span>
                            </button>
                            <ul class="dropdown-menu" role="menu">
                                <li>
                                    <a ng-click="transactionCtrl.exportData(true)">Current Page (All Columns)</a>
                                </li>
                                <li>
                                    <a ng-click="transactionCtrl.exportData(false)">Current Page (Selected Columns)</a>
                                </li>
                            </ul>
                        </div>
                    </div>
                    <div class="heading-action">
                        <select class="sel-columns hidden" id="sel-transaction-columns" multiple="multiple" style="display: none;" ng-model="transactionCtrl.vm.userEvent.selectedColumns">
                            <option ng-if="!column.Optional" selected="selected" disabled="disabled" ng-repeat="column in transactionCtrl.vm.transactionColumns" value="{{ column.PropertyId }}">{{ column.HeaderTitle }}</option>
                            <option ng-if="column.Optional" selected="{{ column.DefaultSelected }}" ng-repeat="column in transactionCtrl.vm.transactionColumns" value="{{ column.PropertyId }}">{{ column.HeaderTitle }}</option>
                        </select>
                    </div>
                </div>
            </div>
        </div>
        <div class="clearfix"></div>
    </div>
</div>

<div class="fh-breadcrumb">
    <div class="full-height">
        <div class="full-height-scroll" slimscroll='{"height": "100%"}'>
            <div class="element-detail-box">
                <div class="ibox ibox-tabbed" id="ibox-transactions">
                    <div class="ibox-content">
                        <div class="tabs-container">
                            <ul class="nav nav-tabs">
                                <li class="{{transactionCtrl.activeIfStatus(1)}}">
                                    <a ng-click="transactionCtrl.statusChanged('pending')">Pending</a>
                                </li>
                                <li class="{{transactionCtrl.activeIfStatus(3)}}">
                                    <a ng-click="transactionCtrl.statusChanged('completed')">Completed</a>
                                </li>
                                <li class="{{transactionCtrl.activeIfStatus(0)}}">
                                    <a ng-click="transactionCtrl.statusChanged('')">All</a>
                                </li>
                            </ul>
                            <div class="tab-content">
                                <div class="tab-pane active">
                                    <div class="tab-pane-body">
                                        <div class="filter-bar">
                                            <div class="row">
                                                <!--@* For 1 user, such as Network View of a Customer's Transactions, or Customer's Transactions *@-->
                                                <div class="col-lg-8 filter-col" ng-show="transactionCtrl.vm.userEvent.selectedUserName || transactionCtrl.vm.userEvent.selectedMethodName">
                                                    <div class="inline">Payment Methods: </div>
                                                    <select ng-model="transactionCtrl.vm.userEvent.selectedMethodId" ng-show="transactionCtrl.vm.userEvent.selectedUserName"
                                                            class="selectpicker inline sel-columns" id="sel-payment-method" data-style="btn-white" data-container="body" ng-change="transactionCtrl.getTransactions()">
                                                        <option value="">(All Payment Methods)</option>
                                                        <option ng-repeat="method in transactionCtrl.vm.userPaymentMethods" ng-if="!method.IsDeleted" value="{{method.Id}}"
                                                                data-content="<img src='{{method.ImageUrl}}' height='20px' class='m-r-xs'/> {{method.Name}}">
                                                            {{method.Name}}
                                                        </option>
                                                        <optgroup label="Deleted">
                                                            <option ng-repeat="method in transactionCtrl.vm.userPaymentMethods" ng-if="method.IsDeleted" value="{{method.Id}}"
                                                                    data-content="<img src='{{method.ImageUrl}}' height='20px' class='m-r-xs'/> {{method.Name}}">
                                                                {{method.Name}}
                                                            </option>
                                                        </optgroup>
                                                    </select>
                                                </div>
                                                <div class="col-lg-4 filter-col" ng-show="transactionCtrl.getFilterDisplayText()">
                                                    <div class="filter-search">
                                                        <div class="input-group">
                                                            <div class="has-feedback">
                                                                <input type="text" class="form-control txt-search" placeholder="Search" ng-model="transactionCtrl.vm.filter.SearchText" ng-keypress="transactionCtrl.keyPress($event)" />
                                                                <i class="fa fa-search form-control-feedback"></i>
                                                            </div>
                                                            <div class="input-group-btn">
                                                                <button type="button" class="btn btn-white btn-filter" data-toggle="collapse" data-target=".filter-expansion">
                                                                    <i class="fa fa-filter"></i>
                                                                    <span>Filter</span>
                                                                </button>
                                                            </div>
                                                        </div>
                                                    </div>
                                                </div>
                                                <!--@* For many users, such as Network All Transactions *@-->
                                                <div class="col-lg-12 filter-col" ng-show="!transactionCtrl.getFilterDisplayText()">
                                                    <div class="filter-search">
                                                        <div class="input-group">
                                                            <div class="has-feedback">
                                                                <input type="text" class="form-control txt-search" placeholder="Search" ng-model="transactionCtrl.vm.filter.SearchText" ng-keypress="transactionCtrl.keyPress($event)" />
                                                                <i class="fa fa-search form-control-feedback"></i>
                                                            </div>
                                                            <div class="input-group-btn">
                                                                <button type="button" class="btn btn-white btn-filter" data-toggle="collapse" data-target=".filter-expansion">
                                                                    <i class="fa fa-filter"></i>
                                                                    <span>Filter</span>
                                                                </button>
                                                            </div>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>

                                            <div class="filter-expansion collapse">
                                                <div class="row">
                                                    <div class="col-md-4">
                                                        <div class="form-group">
                                                            <label class="control-label">Transaction Date Range</label>
                                                            <div class="has-feedback">
                                                                <input id="txt-filter-time-range" type="text" class="form-control daterange" readonly ng-model="transactionCtrl.vm.filter.TimeRange" />
                                                                <i class="fa fa-calendar-o form-control-feedback"></i>
                                                            </div>
                                                        </div>
                                                    </div>
                                                </div>
                                                <button type="button" ng-click="transactionCtrl.getTransactions()" class="btn btn-success">Search</button>
                                            </div>
                                        </div>

                                        <div class="table-responsive">
                                            <table class="table table-striped table-sortable">
                                                <thead>
                                                    <tr>
                                                        <th ng-repeat="column in transactionCtrl.vm.transactionColumns" class="col-header" ng-class="transactionCtrl.isShowColumn(column.PropertyId)">
                                                            <a>{{ column.HeaderTitle }}</a><i class="fa fa-sort"></i>
                                                        </th>
                                                    </tr>
                                                </thead>
                                                <tbody>
                                                    <tr ng-show="transactionCtrl.vm.paging.totalRecord <= 0">
                                                        <td colspan="{{transactionCtrl.vm.transactionColumns.length}}" class="td-nothing">No records are available for this tab.</td>
                                                    </tr>

                                                    <tr ng-repeat="transaction in transactionCtrl.vm.transactions">
                                                        <td ng-repeat="column in transactionCtrl.vm.transactionColumns" ng-class="transactionCtrl.isShowColumn(column.PropertyId)">
                                                            <div ng-if="column.ColumnDataType === 'DELIVERY_LINK'">
                                                                <div>
                                                                    <a ng-href="/Deliveries/Delivery?id={{transaction[column.DataField]}}">{{transaction[column.FieldName]}}</a>
                                                                </div>
                                                            </div>
                                                            <div ng-if="column.ColumnDataType === 'STATUS'">
                                                                <div ng-if="transaction.Status == 3">
                                                                    <em class="label label-success">Paid</em>
                                                                </div>
                                                                <div ng-if="transaction.Status == 1">
                                                                    <em class="label label-primary">Draft</em>
                                                                </div>
                                                                <div ng-if="transaction.Status == 5 || transaction.Status == 2">
                                                                    <em class="label label-warning">Awaiting Payment</em>
                                                                </div>
                                                            </div>
                                                            <div ng-if="column.ColumnDataType === 'INVOICE_LINK'">
                                                                <a ng-href="/Network/Invoice/View/{{transaction[column.DataField]}}">{{transaction[column.FieldName]}}</a>
                                                            </div>
                                                            <div ng-if="column.ColumnDataType === 'IMAGE'">
                                                                <img ng-src="{{ transaction[column.EmbedField][column.DataField] }}" height="30" class="m-r-xs" />{{ transaction[column.EmbedField][column.FieldName]}}
                                                            </div>
                                                            <div ng-if="column.ColumnDataType === 'MONEY'">{{transaction.Amount.Symbol}} {{transaction.Amount.Value|number:2}}</div>
                                                            <div ng-if="column.ColumnDataType == 'COMMON'" ng-class="transactionCtrl.getTypeClass(transaction[column.FieldName], 'label')">{{transaction[column.FieldName]}}</div>
                                                            <div ng-if="column.ColumnDataType == 'DATE'">{{ transaction[column.FieldName] | date : 'dd MMM yyyy HH:mm:ss'}}</div> <!---->
                                                        </td>
                                                    </tr>
                                                </tbody>
                                            </table>
                                        </div>

                                        <div class="pull-right form-inline">
                                            <span ng-show="transactionCtrl.vm.transactions.length > 1 || transactionCtrl.vm.paging.currentPage > 1">Showing {{(transactionCtrl.vm.paging.currentPage - 1) * transactionCtrl.vm.paging.pageSize + 1}} - {{(transactionCtrl.vm.paging.currentPage - 1) * transactionCtrl.vm.paging.pageSize + transactionCtrl.vm.transactions.length}} of {{transactionCtrl.vm.paging.totalRecord}} transactions</span>
                                            <select required ng-model="transactionCtrl.vm.paging.pageSize" ng-change="transactionCtrl.getTransactions()" class="form-control inline">
                                                <option value="10">10 rows</option>
                                                <option value="20">20 rows</option>
                                                <option value="50">50 rows</option>
                                                <option value="100">100 rows</option>
                                            </select>
                                            <uib-pagination total-items="transactionCtrl.vm.paging.totalRecord" ng-model="transactionCtrl.vm.paging.currentPage"
                                                            items-per-page="transactionCtrl.vm.paging.pageSize" style="margin-bottom: -13px" class="pagination pagination-sm inline"
                                                            ng-change="transactionCtrl.getTransactions()" previous-text="&lsaquo;" next-text="&rsaquo;" first-text="&laquo;" last-text="&raquo;">
                                            </uib-pagination>
                                        </div>
                                        <div class="clearfix"></div>
                                    </div>
                                    <div class="ibox-footer">
                                        <em>Payments are only processed and shown for closed deliveries.</em>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
<ng-include src="'/scripts/app/modules/payment/network/transactions/_invoice.view.html'"></ng-include>
